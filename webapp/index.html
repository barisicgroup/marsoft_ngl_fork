<!DOCTYPE html>
<html lang="en">

<head>
  <title>MARILIA webapp</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="./css/font-awesome.min.css" />
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="subresource" href="./css/light.css" />
  <link rel="subresource" href="./css/dark.css" />
</head>

<body>
  <!-- NGL -->
  <script src="build/js/ngl.dev.js"></script>

  <!-- UI -->
  <script src="js/lib/signals.min.js"></script>
  <script src="js/lib/tether.min.js"></script>
  <script src="js/lib/colorpicker.min.js"></script>
  <script src="js/ui/ui.js"></script>
  <script src="js/ui/ui.extra.js"></script>
  <script src="js/ui/ui.ngl.js"></script>
  <script src="js/gui.js"></script>

  <script>
    NGL.cssDirectory = "css/"
    NGL.documentationUrl = "build/docs/"
    NGL.examplesListUrl = "ngl_scripts/scriptsList.json"
    NGL.examplesScriptUrl = "ngl_scripts/"

    // Datasources
    //NGL.DatasourceRegistry.add("data", new NGL.StaticDatasource("./data/"))
    var mdsrv = NGL.getQuery("mdsrv")
    if (mdsrv) {
      var mdsrvDatasource = new NGL.MdsrvDatasource(mdsrv)
      NGL.DatasourceRegistry.add("file", mdsrvDatasource)
      NGL.setListingDatasource(mdsrvDatasource)
      NGL.setTrajectoryDatasource(mdsrvDatasource)
    }

    var stage;
    document.addEventListener("DOMContentLoaded", function () {
      stage = new NGL.Stage()
      NGL.StageWidget(stage)

      var load = NGL.getQuery("load")
      if (load) stage.loadFile(load, { defaultRepresentation: true })

      var script = NGL.getQuery("script")
      if (script) stage.loadScript("scripts/" + script + ".js")

      var struc = NGL.getQuery("struc")
      var traj = NGL.getQuery("traj")
      if (struc) {
        stage.loadFile(struc, {
          defaultRepresentation: true
        }).then(function (o) {
          if (traj) o.addTrajectory(traj)
        })
      }

      /*stage.mouseObserver.signals.clicked.add(function () {
        // 1 is left button
        if (stage.mouseObserver.buttons !== 1) { return; }
        
        //let ssPos = stage.mouseObserver.canvasPosition;
        //let canvasSize = new NGL.Vector3(stage.viewer.container.clientWidth, stage.viewer.container.clientHeight);
        let ndc = stage.mouseObserver.getNdcPosition(); //ssPos.divide(canvasSize).multiplyScalar(2.0).subScalar(1.0);
        let worldPos = new NGL.Vector3(ndc.x, ndc.y, 0).unproject(stage.viewer.camera);
        //let invertedSceneMatrix = new NGL.Matrix4().getInverse(stage.viewerControls.getOrientation());
        //worldPos.applyMatrix4(invertedSceneMatrix);

        var shape = new NGL.Shape("shapeFromScratch");
        shape.addCylinder([worldPos.x, worldPos.y, worldPos.z], [worldPos.x, worldPos.y, worldPos.z - 5], [1, .1, 0], 1.5);
        var shapeComp = stage.addComponentFromObject(shape);
        shapeComp.addRepresentation("buffer");
        //shapeComp.autoView();
      });*/
    })

  </script>
</body>

</html>