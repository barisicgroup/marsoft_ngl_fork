<!DOCTYPE html>
<html lang="en">

<head>
  <title>MARILIA webapp</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="./css/font-awesome.min.css" />
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="subresource" href="./css/light.css" />
  <link rel="subresource" href="./css/dark.css" />
</head>

<body>
  <!-- NGL -->
  <script src="build/js/ngl.dev.js"></script>

  <!-- UI -->
  <script src="js/lib/signals.min.js"></script>
  <script src="js/lib/tether.min.js"></script>
  <script src="js/lib/colorpicker.min.js"></script>
  <script src="js/ui/ui.js"></script>
  <script src="js/ui/ui.extra.js"></script>
  <script src="js/ui/ui.ngl.js"></script>
  <script src="js/gui.js"></script>

  <script>
    NGL.cssDirectory = "css/"
    NGL.documentationUrl = "build/docs/"
    NGL.examplesListUrl = "ngl_scripts/scriptsList.json"
    NGL.examplesScriptUrl = "ngl_scripts/"

    // Datasources
    //NGL.DatasourceRegistry.add("data", new NGL.StaticDatasource("./data/"))
    var mdsrv = NGL.getQuery("mdsrv")
    if (mdsrv) {
      var mdsrvDatasource = new NGL.MdsrvDatasource(mdsrv)
      NGL.DatasourceRegistry.add("file", mdsrvDatasource)
      NGL.setListingDatasource(mdsrvDatasource)
      NGL.setTrajectoryDatasource(mdsrvDatasource)
    }

    var stage;
    document.addEventListener("DOMContentLoaded", function () {
      stage = new NGL.Stage()
      NGL.StageWidget(stage)

      var load = NGL.getQuery("load")
      if (load) stage.loadFile(load, { defaultRepresentation: true })

      var script = NGL.getQuery("script")
      if (script) stage.loadScript("scripts/" + script + ".js")

      var struc = NGL.getQuery("struc")
      var traj = NGL.getQuery("traj")
      if (struc) {
        stage.loadFile(struc, {
          defaultRepresentation: true
        }).then(function (o) {
          if (traj) o.addTrajectory(traj)
        })
      }

      //stage.mouseObserver.signals.clicked.add(function () {
      stage.signals.clicked.add(function (pickingProxy) {
        if (stage.mouseObserver.buttons !== NGL.LeftMouseButton || pickingProxy !== undefined) { return; }

        const worldPos = stage.mouseObserver.getWorldPosition();

        let shapeRepres1 = new NGL.Shape("Cylindrical Bone");
        shapeRepres1.addCylinder([worldPos.x, worldPos.y, worldPos.z], [worldPos.x, worldPos.y, worldPos.z - 5], [1, .1, 0], 1.5);

        let shapeRepres2 = new NGL.Shape("Spherical Bally Ball", { disableImpostor: true });
        shapeRepres2.addSphere([worldPos.x, worldPos.y, worldPos.z], [1, .1, 0], 2.5);
        shapeRepres2.addSphere([worldPos.x, worldPos.y, worldPos.z - 5], [1, .1, 0], 2.5);

        let newComp = new NGL.CustomComponent(stage, null);
        newComp.setName("From Scratch");
        stage.addComponent(newComp);

        newComp.addRepresentation("Cylinder Repres", shapeRepres1);
        newComp.addRepresentation("Sphere Repres", shapeRepres2);


      });
    })

  </script>
</body>

</html>