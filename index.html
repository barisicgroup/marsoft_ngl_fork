<!DOCTYPE html>
<html lang="en">

<head>
  <title>MARILIA webapp</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="./css/font-awesome.min.css" />
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="subresource" href="./css/light.css" />
  <link rel="subresource" href="./css/dark.css" />
</head>

<body>
  <!-- NGL -->
  <script src="build/js/ngl.dev.js"></script>

  <!-- UI -->
  <script src="js/lib/signals.min.js"></script>
  <script src="js/lib/tether.min.js"></script>
  <script src="js/lib/colorpicker.min.js"></script>
  <script src="js/ui/ui.js"></script>
  <script src="js/ui/ui.extra.js"></script>
  <script src="js/ui/ui.ngl.js"></script>
  <script src="js/gui.js"></script>

  <script>
    NGL.cssDirectory = "css/"
    NGL.documentationUrl = "build/docs/"
    NGL.examplesListUrl = "ngl_scripts/scriptsList.json"
    NGL.examplesScriptUrl = "ngl_scripts/"

    // Datasources
    //NGL.DatasourceRegistry.add("data", new NGL.StaticDatasource("./data/"))
    var mdsrv = NGL.getQuery("mdsrv")
    if (mdsrv) {
      var mdsrvDatasource = new NGL.MdsrvDatasource(mdsrv)
      NGL.DatasourceRegistry.add("file", mdsrvDatasource)
      NGL.setListingDatasource(mdsrvDatasource)
      NGL.setTrajectoryDatasource(mdsrvDatasource)
    }

    var stage;
    document.addEventListener("DOMContentLoaded", function () {
      stage = new NGL.Stage()
      NGL.StageWidget(stage)

      var load = NGL.getQuery("load")
      if (load) stage.loadFile(load, { defaultRepresentation: true })

      var script = NGL.getQuery("script")
      if (script) stage.loadScript("scripts/" + script + ".js")

      var struc = NGL.getQuery("struc")
      var traj = NGL.getQuery("traj")
      if (struc) {
        stage.loadFile(struc, {
          defaultRepresentation: true
        }).then(function (o) {
          if (traj) o.addTrajectory(traj)
        })
      }

      let newComponentPositions = [];
      let lastClickTime = new Date();
      const doubleClickDelay = 0.5;

      stage.signals.clicked.add(function (pickingProxy) {
        if (pickingProxy !== undefined) { return; }

        let currTime = new Date();
        
        if ((currTime.getTime() - lastClickTime.getTime()) / 1000.0 <= doubleClickDelay) {
          let newStructure = new NGL.DnaOrigamiNanostructure("DNA Origami Nanostructure", newComponentPositions);

          let newComp = new NGL.CustomComponent(stage, newStructure);
          newComp.setName("From Scratch");
          stage.addComponent(newComp);

          newComp.addRepresentation("multiscale");
          newComponentPositions = [];
        }
        else {
          newComponentPositions.push(stage.mouseObserver.getWorldPosition());
        }
        lastClickTime = currTime;
      });
    })

  </script>
</body>

</html>